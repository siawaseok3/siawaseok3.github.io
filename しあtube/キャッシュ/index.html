<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>キャッシュ確認</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background-color: #fff; color: #000; }
  h2 { margin-bottom: 10px; }
  #count { margin-bottom: 20px; font-weight: bold; }
  .cache-item { border: 1px solid #ddd; border-radius: 8px; padding: 12px; margin-bottom: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
  .cache-header { display: flex; justify-content: space-between; align-items: center; font-weight: normal; font-size: 16px; }
  .cache-details { display: none; margin-top: 10px; padding-left: 5px; }
  button { padding: 6px 12px; margin-bottom: 20px; cursor: pointer; }
  .toggle-btn { background-color: #eee; border: 1px solid #ccc; border-radius: 4px; padding: 2px 6px; font-size: 12px; cursor: pointer; }
</style>
</head>
<body>
<h2>しあtube動画キャッシュ</h2>
<div id="count">合計: 読み込み中...</div>
<button id="refreshBtn">更新</button>
<div id="cacheContainer">読み込み中...</div>
<script>
const CACHE_URL = "https://siawaseok.f5.si/api/cache";

async function fetchCache() {
  try {
    const res = await fetch(CACHE_URL);
    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    const data = await res.json();
    displayCache(data);
  } catch (err) {
    document.getElementById("cacheContainer").innerText = "取得失敗: " + err;
    document.getElementById("count").innerText = "合計: 不明";
  }
}

function displayCache(data) {
  const container = document.getElementById("cacheContainer");
  const countEl = document.getElementById("count");
  container.innerHTML = ""; 

  const total = Object.keys(data).length;
  countEl.innerText = `合計: ${total} 件`;

  Object.entries(data).forEach(([id, info]) => {
    const item = document.createElement("div");
    item.className = "cache-item";

    const header = document.createElement("div");
    header.className = "cache-header";

    const title = document.createElement("span");
    title.innerText = id;

    const toggleBtn = document.createElement("span");
    toggleBtn.className = "toggle-btn";
    toggleBtn.innerText = "詳細表示";
    header.appendChild(title);
    header.appendChild(toggleBtn);
    item.appendChild(header);

    const details = document.createElement("div");
    details.className = "cache-details";
    details.innerHTML = `
      <div>経過時間: ${info.age_sec} 秒</div>
      <div>残り時間: ${info.remaining_sec} 秒</div>
      <div>有効期間: ${info.duration_sec} 秒</div>
    `;
    details.style.display = "none";
    item.appendChild(details);

    toggleBtn.onclick = () => {
      const isHidden = window.getComputedStyle(details).display === "none";
      if(isHidden) {
        details.style.display = "block";
        toggleBtn.innerText = "詳細を隠す";
      } else {
        details.style.display = "none";
        toggleBtn.innerText = "詳細表示";
      }
    };

    container.appendChild(item);
  });
}

document.getElementById("refreshBtn").addEventListener("click", fetchCache);
fetchCache();
</script>
</body>
</html>
